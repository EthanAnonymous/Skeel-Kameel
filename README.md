# Overberg Transport Connect

A modern web application for transport services built with React, TypeScript, and Tailwind CSS.

## Project Setup

This project is set up as a static site optimized for deployment on GitHub Pages.

## Requirements

- Node.js & npm installed (for local development and building)
- Git installed
- GitHub account with a repository

## Getting Started

### Build Setup

```sh
# Step 1: Navigate to the project directory
cd overberg-transport-connect-main

# Step 2: Install dependencies
npm install

# Step 3: Build the application
npm run build
```

### Deploy to GitHub Pages

1. **Build locally**: `npm run build` (creates optimized `dist/` folder)
2. **Push to repository**: 
   ```sh
   git add .
   git commit -m "Build for GitHub Pages"
   git push origin main
   ```
3. **Enable GitHub Pages**:
   - Go to your repository settings
   - Navigate to "Pages" section
   - Set source to `main` branch and `/root` directory
   - Your site will be available at `https://yourusername.github.io/repository-name/`

### How It Works

- Vite builds the React app into static HTML/CSS/JS files
- The `dist/` folder contains all static assets
- GitHub Pages serves these files directly
- React Router handles client-side navigation automatically

## Development

### Available Scripts

- `npm run build` - Build for production (creates optimized `dist/` folder)
- `npm run build:dev` - Build in development mode
- `npm run lint` - Run ESLint to check code quality
- `npm test` - Run tests once
- `npm run test:watch` - Run tests in watch mode

### How it Works

1. **React SPA Build**: `npm run build` creates an optimized production build in the `dist/` folder
2. **Static Site**: GitHub Pages serves the built files as static HTML/CSS/JS
3. **Client-Side Routing**: React Router handles all navigation in the browser
4. **No Server Required**: Everything runs in the browser - no backend server needed for the UI

## Technologies

This project is built with:

- **Vite** - Build tool (compiles React to static files)
- **TypeScript** - Type-safe JavaScript
- **React** - UI library
- **shadcn-ui** - High-quality UI components
- **Tailwind CSS** - Utility-first CSS framework
- **React Hook Form** - Performant form handling
- **React Query** - Data fetching and caching
- **React Router** - Client-side navigation

## Features

### Booking System
- **Online Booking Form**: Customers can book rides directly through the web interface
- **Vehicle Selection**: Choose between Standard, Premium, and Van options
- **Fare Estimation**: Real-time fare calculation based on vehicle type
- **Booking Status Tracking**: Monitor pending, confirmed, completed, and cancelled bookings
- **Booking History**: View all previous bookings with detailed information

### Invoicing System
- **Auto-Generated Invoices**: Invoices are automatically created when bookings are submitted
- **Itemized Charges**: Professional invoice layout with itemized service charges
- **Tax Calculation**: 15% tax automatically applied to all invoices
- **Payment Status**: Track invoice payment status (unpaid, paid, overdue)
- **PDF Export**: Download invoices as PDF (placeholder for backend implementation)
- **Email Integration**: Send invoices via email (placeholder for backend implementation)

## Project Structure

```
src/
├── components/
│   ├── ui/                    # shadcn-ui components
│   ├── BookingForm.tsx        # Main booking form component
│   ├── InvoiceDisplay.tsx     # Invoice display component
│   ├── ContactForm.tsx
│   ├── Footer.tsx
│   ├── Hero.tsx
│   ├── NavLink.tsx
│   ├── RateCard.tsx
│   └── ReassuranceBar.tsx
├── hooks/                     # Custom React hooks
├── lib/
│   ├── utils.ts              # Utility functions
│   └── booking-utils.ts      # Booking & invoice utilities
├── pages/
│   ├── Index.tsx             # Home page
│   ├── BookingPage.tsx       # Booking & invoicing page
│   └── NotFound.tsx
├── types/
│   └── booking.ts            # TypeScript types for bookings & invoices
├── App.tsx                    # Root component
└── main.tsx                   # Entry point

dist/                          # Build output (generated by npm run build)
server.js                      # Development server (local only)
```

## Deployment on GitHub Pages

The application is pre-configured for GitHub Pages deployment:

1. **Build**: Run `npm run build` locally
2. **Push**: Commit and push the built files to your GitHub repository
3. **Enable**: Go to repository Settings → Pages → select main branch
4. **Deploy**: GitHub automatically deploys the `dist/` folder
5. **URL**: Access at `https://yourusername.github.io/repository-name/`

## Database & Backend Integration

### Current Implementation: Google Apps Script + Google Sheets

The application uses **Google Apps Script** as a middleware API and **Google Sheets** as the database. This approach is free, easy to maintain, and requires no backend server infrastructure.

### Google Sheets + Google Apps Script Setup Instructions

#### Step 1: Create a Google Sheet

1. Go to [Google Sheets](https://sheets.google.com/)
2. Create a new blank spreadsheet
3. Name it: `Overberg Transport Bookings`
4. You'll need two sheets: `Bookings` and `Invoices`

#### Step 2: Set Up the Bookings Sheet

In the first sheet named `Bookings`, add these column headers in row 1:
- A: `id`
- B: `passengerName`
- C: `passengerPhone`
- D: `passengerEmail`
- E: `pickupLocation`
- F: `dropoffLocation`
- G: `pickupDate`
- H: `pickupTime`
- I: `vehicleType`
- J: `distanceKm`
- K: `estimatedFare`
- L: `status`
- M: `createdAt`

#### Step 3: Set Up the Invoices Sheet

Create a new sheet named `Invoices` and add these column headers:
- A: `id`
- B: `bookingId`
- C: `invoiceNumber`
- D: `passengerName`
- E: `passengerEmail`
- F: `items` (JSON array as string)
- G: `subtotal`
- H: `tax`
- I: `total`
- J: `paymentStatus`
- K: `createdAt`

#### Step 4: Create Google Apps Script

1. In your Google Sheet, click "Tools" → "Script Editor"
2. Replace all code with this template (see full code below):

```javascript
// Google Apps Script Code
// Paste this entire script into your Google Apps Script editor

const BOOKINGS_SHEET = "Bookings";
const INVOICES_SHEET = "Invoices";

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const action = data.action;
    const payload = data.data;

    let result;

    switch (action) {
      case 'saveBooking':
        result = saveBooking(payload);
        break;
      case 'getBookings':
        result = getBookings();
        break;
      case 'updateBookingStatus':
        result = updateBookingStatus(payload.bookingId, payload.status);
        break;
      case 'cancelBooking':
        result = cancelBooking(payload.bookingId);
        break;
      case 'saveInvoice':
        result = saveInvoice(payload);
        break;
      case 'getInvoices':
        result = getInvoices();
        break;
      case 'updateInvoicePaymentStatus':
        result = updateInvoicePaymentStatus(payload.invoiceId, payload.paymentStatus);
        break;
      default:
        return ContentService.createTextOutput(JSON.stringify({
          success: false,
          error: 'Unknown action'
        })).setMimeType(ContentService.MimeType.JSON);
    }

    return ContentService.createTextOutput(JSON.stringify({
      success: true,
      data: result
    })).setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      success: false,
      error: error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}

function saveBooking(booking) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(BOOKINGS_SHEET);
  const row = [
    booking.id,
    booking.passengerName,
    booking.passengerPhone,
    booking.passengerEmail,
    booking.pickupLocation,
    booking.dropoffLocation,
    booking.pickupDate,
    booking.pickupTime,
    booking.vehicleType,
    booking.distanceKm,
    booking.estimatedFare,
    booking.status || 'pending',
    new Date().toISOString()
  ];
  sheet.appendRow(row);
  return booking;
}

function getBookings() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(BOOKINGS_SHEET);
  const data = sheet.getDataRange().getValues();
  const bookings = [];

  for (let i = 1; i < data.length; i++) {
    bookings.push({
      id: data[i][0],
      passengerName: data[i][1],
      passengerPhone: data[i][2],
      passengerEmail: data[i][3],
      pickupLocation: data[i][4],
      dropoffLocation: data[i][5],
      pickupDate: data[i][6],
      pickupTime: data[i][7],
      vehicleType: data[i][8],
      distanceKm: data[i][9],
      estimatedFare: data[i][10],
      status: data[i][11],
      createdAt: data[i][12]
    });
  }

  return bookings;
}

function updateBookingStatus(bookingId, status) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(BOOKINGS_SHEET);
  const data = sheet.getDataRange().getValues();

  for (let i = 1; i < data.length; i++) {
    if (data[i][0] === bookingId) {
      sheet.getRange(i + 1, 12).setValue(status);
      return { success: true };
    }
  }

  throw new Error('Booking not found');
}

function cancelBooking(bookingId) {
  return updateBookingStatus(bookingId, 'cancelled');
}

function saveInvoice(invoice) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(INVOICES_SHEET);
  const row = [
    invoice.id,
    invoice.bookingId,
    invoice.invoiceNumber,
    invoice.passengerName,
    invoice.passengerEmail,
    JSON.stringify(invoice.items),
    invoice.subtotal,
    invoice.tax,
    invoice.total,
    invoice.paymentStatus || 'unpaid',
    new Date().toISOString()
  ];
  sheet.appendRow(row);
  return invoice;
}

function getInvoices() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(INVOICES_SHEET);
  const data = sheet.getDataRange().getValues();
  const invoices = [];

  for (let i = 1; i < data.length; i++) {
    invoices.push({
      id: data[i][0],
      bookingId: data[i][1],
      invoiceNumber: data[i][2],
      passengerName: data[i][3],
      passengerEmail: data[i][4],
      items: JSON.parse(data[i][5]),
      subtotal: data[i][6],
      tax: data[i][7],
      total: data[i][8],
      paymentStatus: data[i][9],
      createdAt: data[i][10]
    });
  }

  return invoices;
}

function updateInvoicePaymentStatus(invoiceId, paymentStatus) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(INVOICES_SHEET);
  const data = sheet.getDataRange().getValues();

  for (let i = 1; i < data.length; i++) {
    if (data[i][0] === invoiceId) {
      sheet.getRange(i + 1, 10).setValue(paymentStatus);
      return { success: true };
    }
  }

  throw new Error('Invoice not found');
}
```

#### Step 5: Deploy as Web App

1. In the Script Editor, click "Deploy" → "New deployment"
2. Select "Type" → "Web app"
3. Set "Execute as" → Your Google Account
4. Set "Who has access" → "Anyone"
5. Click "Deploy"
6. Copy the deployment URL (looks like: `https://script.google.com/macros/s/YOUR_ID/usercript`)

#### Step 6: Add Environment Variable

1. Copy `.env.example` to `.env.local`:
   ```sh
   cp .env.example .env.local
   ```

2. Edit `.env.local` and add your deployment URL:
   ```
   VITE_GAS_DEPLOYMENT_URL=https://script.google.com/macros/s/YOUR_ID/usercript
   ```

**⚠️ Important**: Never commit `.env.local` to Git. It's already in `.gitignore`.

### Features Now Enabled

✅ **Persistent Booking Storage** - Bookings save to Google Sheets
✅ **Auto-Generated Invoices** - Invoices created automatically  
✅ **Booking History** - All bookings loaded from Google Sheets
✅ **Status Updates** - Update booking status directly from the UI
✅ **Booking Cancellation** - Cancel bookings with one click
✅ **Free Database** - No costs, unlimited usage

### Accessing Your Data

#### View Data in Google Sheets
1. Open your Google Sheet: `Overberg Transport Bookings`
2. Switch between `Bookings` and `Invoices` sheets
3. See all data in real-time as bookings are submitted

#### Edit or Delete Data
- You can manually edit cells in the sheet
- Delete rows to remove bookings or invoices
- All changes take effect immediately

### Advantages of This Approach

✅ **Free** - No hosting or database costs
✅ **Easy to Manage** - Familiar Google Sheets interface
✅ **No Backend Infrastructure** - Google handles all hosting
✅ **Instant Data Access** - View bookings anytime in Google Sheets
✅ **Automatic Scaling** - No server management needed
✅ **Data Export** - Easy to export data as CSV or Excel

### Troubleshooting

- **CORS errors**: Make sure deployment is set to "Anyone" access
- **"Failed to save booking"**: Check that deployment URL is correct in `.env.local`
- **Data not appearing**: Ensure Google Sheets is accessible and Scripts are deployed
- **Environment variable not loading**: Restart dev server after updating `.env.local`
- **Script errors**: Check Google Apps Script execution logs (Execution → View logs)

### Future Enhancements

- **Authentication**: Add user login for passenger history
- **Email Notifications**: Use Google Mail service to send confirmations
- **Data Validation**: Add spreadsheet data validation rules
- **Reports**: Create Google Sheets charts and reports
- **Backup**: Enable version history in Google Sheets

## License

MIT
